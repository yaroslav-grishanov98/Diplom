{% extends "library_app/base.html" %}

{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<h1>{{ book.title }}</h1>

{% if book.cover %}
<img src="{{ book.cover.url }}" alt="{{ book.title }} cover" style="max-width: 300px;">
{% endif %}

<p><strong>Жанр:</strong> {{ book.genre }}</p>
<p><strong>Опубликовано:</strong> {{ book.published_date }}</p>

<p><strong>Средний рейтинг:</strong> {{ average_rating|default:"No ratings yet" }}</p>

<p><strong>Описание:</strong></p>
<p>{{ book.description }}</p>

<p><strong>Автор:</strong></p>
<ul>
    {% for author in book.authors.all %}
    <li><a href="{% url 'author_detail' author.id %}">{{ author.first_name }} {{ author.last_name }}</a></li>
    {% empty %}
    <li>Автор не указан.</li>
    {% endfor %}
</ul>

{% if user.is_authenticated %}
<form method="post" action="{% url 'book_issue_create' book.id %}">
    {% csrf_token %}
    <label for="rental_period">Срок аренды(дни):</label>
    <select name="rental_period" id="rental_period" class="form-select mb-2">
        <option value="7">7 дней</option>
        <option value="14" selected>14 дней</option>
        <option value="21">21 день</option>
    </select>
    <button type="submit" class="btn btn-primary">Возьмите книгу напрокат!</button>
</form>
{% else %}
<p><a href="{% url 'visitor_login' %}">Log in</a> Взять эту книгу напрокат.</p>
{% endif %}

<hr>

<h3>Комментарии</h3>
<ul>
  {% for comment in comments %}
    <li><strong>{{ comment.user.username }}:</strong> {{ comment.text }} <em>({{ comment.created_at|date:"Y-m-d H:i" }})</em></li>
  {% empty %}
    <li>Нет комментариев.</li>
  {% endfor %}
</ul>

{% if user.is_authenticated %}
<h4>Add a comment</h4>
<form method="post" action="{% url 'add_comment' book.id %}">
    {% csrf_token %}
    <textarea name="text" rows="3" class="form-control" required></textarea>
    <button type="submit" class="btn btn-primary mt-2">Submit</button>
</form>
{% else %}
<p><a href="{% url 'visitor_login' %}">Log in</a> to add a comment.</p>
{% endif %}

<a href="{% url 'book_list' %}" class="btn btn-secondary mt-3">Back to book list</a>
{% endblock %}